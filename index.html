<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ແອັບຄິດໄລ່ລາຍຮັບລາຍຈ່າຍ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Lao', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            font-size: 2.5rem;
            color: white;
            font-weight: 700;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .splash-subtitle {
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            animation: fadeInUp 1s ease 0.5s both;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.8s ease;
        }

        .login-title {
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            color: white;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            font-family: 'Noto Sans Lao', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.02);
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Noto Sans Lao', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main App Container */
        .app-container {
            display: none;
            position: relative;
            min-height: 100vh;
            padding-top: 120px;
            padding-bottom: 30px;
        }

        .app-container.show {
            display: block;
            animation: fadeIn 0.8s ease;
        }

        /* Navigation Tabs */
        .nav-tabs {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 50px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-family: 'Noto Sans Lao', sans-serif;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .nav-tab:hover {
            transform: scale(1.05);
        }

        /* Content Area */
        .content {
            max-width: 450px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.6s ease;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Dashboard Specific Styles */
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .date-picker {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 12px;
            padding: 10px 15px;
            color: white;
            font-family: 'Noto Sans Lao', sans-serif;
            margin-bottom: 20px;
        }

        .dashboard-content {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .cat-emoji {
            width: 120px;
            height: 120px;
            font-size: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        .dashboard-info {
            flex: 1;
            color: white;
        }

        .balance-item {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .balance-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 500;
        }

        .status-success {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            color: white;
        }

        .status-warning {
            background: linear-gradient(45deg, #ff6b6b, #ff9f43);
            color: white;
        }

        /* Form Styles */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .add-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .add-button:hover {
            transform: scale(1.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #333;
        }

        /* Transaction List */
        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 10px;
            color: white;
            animation: slideIn 0.5s ease;
        }

        .transaction-info h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .transaction-amount {
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-white { color: white; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        /* Export Button */
        .export-btn {
            background: linear-gradient(45deg, #48dbfb, #0abde3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-family: 'Noto Sans Lao', sans-serif;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* Number formatting */
        .amount {
            font-family: 'Courier New', monospace;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .nav-tabs {
                gap: 8px;
                padding: 10px;
            }
            
            .nav-tab {
                width: 45px;
                height: 45px;
                font-size: 0.6rem;
            }
            
            .content {
                padding: 0 15px;
            }
            
            .dashboard-content {
                flex-direction: column;
                text-align: center;
            }
            
            .cat-emoji {
                width: 100px;
                height: 100px;
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">💰 ແອັບຄິດໄລ່</div>
        <div class="splash-subtitle">ລາຍຮັບ ລາຍຈ່າຍ ຂອງທ່ານ</div>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2 class="login-title">ເຂົ້າສູ່ລະບົບ</h2>
            
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">Gmail</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="example@gmail.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ລະຫັດຜ່ານ</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="ກະລຸນາໃສ່ລະຫັດຜ່ານ">
                </div>
                <button class="btn btn-primary" onclick="login()">ເຂົ້າສູ່ລະບົບ</button>
                <button class="btn btn-secondary" onclick="showRegister()">ລົງທະບຽນໃໝ່</button>
            </div>

            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Gmail</label>
                    <input type="email" class="form-input" id="regEmail" placeholder="example@gmail.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ລະຫັດຜ່ານ</label>
                    <input type="password" class="form-input" id="regPassword" placeholder="ກະລຸນາໃສ່ລະຫັດຜ່ານ">
                </div>
                <div class="form-group">
                    <label class="form-label">ຢືນຢັນລະຫັດຜ່ານ</label>
                    <input type="password" class="form-input" id="regConfirmPassword" placeholder="ຢືນຢັນລະຫັດຜ່ານອີກຄັ້ງ">
                </div>
                <button class="btn btn-primary" onclick="sendOTP()">ຂໍ OTP</button>
                <div class="form-group" id="otpGroup" style="display: none;">
                    <label class="form-label">OTP Code</label>
                    <input type="text" class="form-input" id="otpCode" placeholder="ໃສ່ລະຫັດ OTP">
                    <button class="btn btn-primary" onclick="verifyOTP()">ຢືນຢັນ OTP</button>
                </div>
                <button class="btn btn-secondary" onclick="showLogin()">ກັບໄປເຂົ້າສູ່ລະບົບ</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('dashboard')">ໜ້າ<br>ຫຼັກ</button>
            <button class="nav-tab" onclick="showPage('expenses')">ລາຍ<br>ຈ່າຍ</button>
            <button class="nav-tab" onclick="showPage('income')">ລາຍ<br>ຮັບ</button>
            <button class="nav-tab" onclick="showPage('special')">ລາຍຮັບ<br>ພິເສດ</button>
            <button class="nav-tab" onclick="showPage('summary')">ສະຫຼຸບ<br>ເດືອນ</button>
            <button class="nav-tab" onclick="showPage('savings')">ເງິນ<br>ເກັບ</button>
        </div>

        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="content-card">
                    <div class="dashboard-header">
                        <input type="date" class="date-picker" id="dashboardDate">
                    </div>
                    
                    <div class="dashboard-content">
                        <div class="cat-emoji" id="catEmoji">😸</div>
                        <div class="dashboard-info">
                            <div class="balance-item">
                                <div class="balance-label">ລາຍຮັບ</div>
                                <div class="balance-amount amount" id="totalIncome">0 ₭</div>
                            </div>
                            <div class="balance-item">
                                <div class="balance-label">ລາຍຈ່າຍ</div>
                                <div class="balance-amount amount" id="totalExpenses">0 ₭</div>
                            </div>
                            <div class="balance-item">
                                <div class="balance-label">ຍອດເຫຼືອ</div>
                                <div class="balance-amount amount" id="balance">0 ₭</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-message" id="statusMessage">
                        <span id="statusEmoji">😊</span>
                        <span id="statusText">ເລີ່ມຕົ້ນການຄິດໄລ່ຂອງທ່ານ!</span>
                    </div>
                </div>
            </div>

            <!-- Expenses Page -->
            <div id="expenses" class="page">
                <div class="content-card">
                    <h2 class="text-white text-center mb-20">ລາຍການລາຍຈ່າຍ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="date" class="form-input" id="expenseSearchDate">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="searchTransactions('expenses')">ຄົ້ນຫາ</button>
                        </div>
                    </div>
                    <div class="transaction-list" id="expensesList"></div>
                </div>
                <button class="add-button" onclick="showAddModal('expense')">+</button>
            </div>

            <!-- Income Page -->
            <div id="income" class="page">
                <div class="content-card">
                    <h2 class="text-white text-center mb-20">ລາຍການລາຍຮັບ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="date" class="form-input" id="incomeSearchDate">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="searchTransactions('income')">ຄົ້ນຫາ</button>
                        </div>
                    </div>
                    <div class="transaction-list" id="incomeList"></div>
                </div>
                <button class="add-button" onclick="showAddModal('income')">+</button>
            </div>

            <!-- Special Income Page -->
            <div id="special" class="page">
                <div class="content-card">
                    <h2 class="text-white text-center mb-20">ລາຍຮັບພິເສດ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="date" class="form-input" id="specialSearchDate">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="searchTransactions('special')">ຄົ້ນຫາ</button>
                        </div>
                    </div>
                    <div class="transaction-list" id="specialList"></div>
                </div>
                <button class="add-button" onclick="showAddModal('special')">+</button>
            </div>

            <!-- Summary Page -->
            <div id="summary" class="page">
                <div class="content-card">
                    <h2 class="text-white text-center mb-20">ສະຫຼຸບລາຍການປະຈຳເດືອນ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="month" class="form-input" id="summaryMonth">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="generateSummary()">ສະຫຼຸບ</button>
                        </div>
                    </div>
                    <div id="summaryContent"></div>
                    <button class="export-btn" onclick="exportSummary()">Export ເປັນ CSV</button>
                </div>
            </div>

            <!-- Savings Page -->
            <div id="savings" class="page">
                <div class="content-card">
                    <h2 class="text-white text-center mb-20">ເງິນເກັບ</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="date" class="form-input" id="savingsSearchDate">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="searchTransactions('savings')">ຄົ້ນຫາ</button>
                        </div>
                    </div>
                    <div class="transaction-list" id="savingsList"></div>
                </div>
                <button class="add-button" onclick="showAddModal('savings')">+</button>
            </div>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h3 class="modal-title" id="modalTitle">ເພີ່ມລາຍການ</h3>
            
            <div class="form-group">
                <label class="form-label">ຊື່ລາຍການ</label>
                <input type="text" class="form-input" id="transactionName" placeholder="ໃສ່ຊື່ລາຍການ">
            </div>
            
            <div class="form-group">
                <label class="form-label">ຈຳນວນເງິນ</label>
                <input type="text" class="form-input" id="transactionAmount" placeholder="0" oninput="formatAmount(this)">
            </div>
            
            <div class="form-group">
                <label class="form-label">ວັນທີ</label>
                <input type="date" class="form-input" id="transactionDate">
            </div>
            
            <button class="btn btn-primary" onclick="addTransaction()">ເພີ່ມລາຍການ</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentTransactionType = '';
        let userData = {};
        let generatedOTP = '';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Show splash screen for 3 seconds
            setTimeout(() => {
                document.getElementById('splashScreen').classList.add('hidden');
            }, 3000);

            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dashboardDate').value = today;
            document.getElementById('transactionDate').value = today;
        });

        // Authentication functions
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        function sendOTP() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (!email || !password || !confirmPassword) {
                alert('ກະລຸນາຕື່ມຂໍ້ມູນໃຫ້ຄົບ');
                return;
            }

            if (password !== confirmPassword) {
                alert('ລະຫັດຜ່ານບໍ່ກົງກັນ');
                return;
            }

            // Generate fake OTP
            generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
            alert(`OTP ຂອງທ່ານແມ່ນ: ${generatedOTP} (ໃນການນຳໃຊ້ຈິງຈະຖືກສົ່ງໄປທີ່ Gmail)`);
            
            document.getElementById('otpGroup').style.display = 'block';
        }

        function verifyOTP() {
            const enteredOTP = document.getElementById('otpCode').value;
            
            if (enteredOTP === generatedOTP) {
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                
                // Save user data (in real app, this would be sent to server)
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                users[email] = {
                    password: password,
                    data: {
                        expenses: [],
                        income: [],
                        special: [],
                        savings: []
                    }
                };
                localStorage.setItem('users', JSON.stringify(users));
                
                alert('ລົງທະບຽນສຳເລັດ!');
                showLogin();
            } else {
                alert('OTP ບໍ່ຖືກຕ້ອງ');
            }
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('ກະລຸນາໃສ່ Gmail ແລະ ລະຫັດຶ້ານ');
                return;
            }

            // Check user credentials (in real app, this would be server validation)
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (users[email] && users[email].password === password) {
                currentUser = email;
                userData = users[email].data;
                
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').classList.add('show');
                
                updateDashboard();
                loadTransactions();
            } else {
                alert('Gmail ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ');
            }
        }

        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Remove active from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked tab
            event.target.classList.add('active');
            
            // Load data for the page
            if (pageId !== 'dashboard') {
                loadTransactions(pageId);
            }
        }

        // Modal functions
        function showAddModal(type) {
            currentTransactionType = type;
            const titles = {
                'expense': 'ເພີ່ມລາຍຈ່າຍ',
                'income': 'ເພີ່ມລາຍຮັບ',
                'special': 'ເພີ່ມລາຍຮັບພິເສດ',
                'savings': 'ເພີ່ມເງິນເກັບ'
            };
            
            document.getElementById('modalTitle').textContent = titles[type];
            document.getElementById('addModal').classList.add('show');
            
            // Clear form
            document.getElementById('transactionName').value = '';
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
        }

        function closeModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        // Transaction functions
        function addTransaction() {
            const name = document.getElementById('transactionName').value;
            const amountStr = document.getElementById('transactionAmount').value;
            const date = document.getElementById('transactionDate').value;
            
            if (!name || !amountStr || !date) {
                alert('ກະລຸນາຕື່ມຂໍ້ມູນໃຫ້ຄົບ');
                return;
            }
            
            const amount = parseFloat(amountStr.replace(/,/g, ''));
            
            const transaction = {
                id: Date.now(),
                name: name,
                amount: amount,
                date: date,
                type: currentTransactionType
            };
            
            // Add to userData
            if (!userData[currentTransactionType + 's']) {
                userData[currentTransactionType + 's'] = [];
            }
            userData[currentTransactionType + 's'].push(transaction);
            
            // Save to localStorage
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            users[currentUser].data = userData;
            localStorage.setItem('users', JSON.stringify(users));
            
            closeModal();
            updateDashboard();
            loadTransactions(currentTransactionType + 's');
            
            alert('ເພີ່ມລາຍການສຳເລັດ!');
        }

        function formatAmount(input) {
            let value = input.value.replace(/,/g, '');
            if (value && !isNaN(value)) {
                input.value = parseFloat(value).toLocaleString();
            }
        }

        function loadTransactions(type = '') {
            const types = type ? [type] : ['expenses', 'income', 'special', 'savings'];
            
            types.forEach(t => {
                const listElement = document.getElementById(t.replace('s', '') + (t === 'expenses' ? 'sList' : 'List'));
                if (listElement) {
                    listElement.innerHTML = '';
                    
                    const transactions = userData[t] || [];
                    transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    transactions.forEach(transaction => {
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div class="transaction-info">
                                <h4>${transaction.name}</h4>
                                <div class="transaction-date">${formatDate(transaction.date)}</div>
                            </div>
                            <div class="transaction-amount amount">${formatCurrency(transaction.amount)}</div>
                        `;
                        listElement.appendChild(item);
                    });
                }
            });
        }

        function searchTransactions(type) {
            const searchDate = document.getElementById(type + 'SearchDate').value;
            if (!searchDate) {
                loadTransactions(type);
                return;
            }
            
            const listElement = document.getElementById(type.replace('expenses', 'expensesList').replace('income', 'incomeList').replace('special', 'specialList').replace('savings', 'savingsList'));
            listElement.innerHTML = '';
            
            const transactions = userData[type] || [];
            const filtered = transactions.filter(t => t.date === searchDate);
            
            filtered.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                item.innerHTML = `
                    <div class="transaction-info">
                        <h4>${transaction.name}</h4>
                        <div class="transaction-date">${formatDate(transaction.date)}</div>
                    </div>
                    <div class="transaction-amount amount">${formatCurrency(transaction.amount)}</div>
                `;
                listElement.appendChild(item);
            });
        }

        function updateDashboard() {
            const selectedDate = document.getElementById('dashboardDate').value;
            const selectedMonth = selectedDate.substring(0, 7); // YYYY-MM format
            
            // Calculate period from 25th to 25th
            const [year, month] = selectedMonth.split('-');
            const periodStart = `${year}-${month.padStart(2, '0')}-25`;
            const nextMonth = parseInt(month) === 12 ? `${parseInt(year) + 1}-01` : `${year}-${(parseInt(month) + 1).toString().padStart(2, '0')}`;
            const periodEnd = `${nextMonth}-25`;
            
            let totalIncome = 0;
            let totalExpenses = 0;
            let totalSpecial = 0;
            let totalSavings = 0;
            
            // Calculate totals for the period
            ['income', 'expenses', 'special', 'savings'].forEach(type => {
                const transactions = userData[type] || [];
                transactions.forEach(t => {
                    if (t.date >= periodStart && t.date < periodEnd) {
                        switch(type) {
                            case 'income':
                                totalIncome += t.amount;
                                break;
                            case 'expenses':
                                totalExpenses += t.amount;
                                break;
                            case 'special':
                                totalSpecial += t.amount;
                                break;
                            case 'savings':
                                totalSavings += t.amount;
                                break;
                        }
                    }
                });
            });
            
            const totalIncomeWithSpecial = totalIncome + totalSpecial;
            const totalSpent = totalExpenses + totalSavings;
            const balance = totalIncomeWithSpecial - totalSpent;
            
            // Update display
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncomeWithSpecial);
            document.getElementById('totalExpenses').textContent = formatCurrency(totalSpent);
            document.getElementById('balance').textContent = formatCurrency(balance);
            
            // Update status message and cat emoji
            const statusMessage = document.getElementById('statusMessage');
            const statusEmoji = document.getElementById('statusEmoji');
            const statusText = document.getElementById('statusText');
            const catEmoji = document.getElementById('catEmoji');
            
            if (balance < 0) {
                statusMessage.className = 'status-message status-warning';
                statusEmoji.textContent = '😠';
                statusText.textContent = 'ໃຊ້ເງິນເກີນງົບແລ້ວ!';
                catEmoji.textContent = '😾';
            } else if (balance > 0) {
                statusMessage.className = 'status-message status-success';
                statusEmoji.textContent = '😊';
                statusText.textContent = 'ເຮັດໄດ້ດີຫຼາຍ!';
                catEmoji.textContent = '😸';
            } else {
                statusMessage.className = 'status-message status-success';
                statusEmoji.textContent = '😐';
                statusText.textContent = 'ພໍດີ';
                catEmoji.textContent = '😺';
            }
        }

        function generateSummary() {
            const summaryMonth = document.getElementById('summaryMonth').value;
            if (!summaryMonth) {
                alert('ກະລຸນາເລືອກເດືອນ');
                return;
            }
            
            const [year, month] = summaryMonth.split('-');
            const periodStart = `${year}-${month.padStart(2, '0')}-25`;
            const nextMonth = parseInt(month) === 12 ? `${parseInt(year) + 1}-01` : `${year}-${(parseInt(month) + 1).toString().padStart(2, '0')}`;
            const periodEnd = `${nextMonth}-25`;
            
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = '';
            
            let html = `
                <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-top: 20px;">
                    <h3 style="color: white; text-align: center; margin-bottom: 20px;">ສະຫຼຸບປະຈຳເດືອນ ${month}/${year}</h3>
            `;
            
            ['income', 'expenses', 'special', 'savings'].forEach(type => {
                const title = {
                    'income': 'ລາຍຮັບ',
                    'expenses': 'ລາຍຈ່າຍ', 
                    'special': 'ລາຍຮັບພິເສດ',
                    'savings': 'ເງິນເກັບ'
                }[type];
                
                html += `<h4 style="color: white; margin: 15px 0;">${title}</h4>`;
                
                const transactions = (userData[type] || []).filter(t => 
                    t.date >= periodStart && t.date < periodEnd
                );
                
                if (transactions.length > 0) {
                    transactions.forEach(t => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; color: rgba(255,255,255,0.8); border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span>${t.name} (${formatDate(t.date)})</span>
                                <span class="amount">${formatCurrency(t.amount)}</span>
                            </div>
                        `;
                    });
                } else {
                    html += `<p style="color: rgba(255,255,255,0.6); font-style: italic;">ບໍ່ມີລາຍການ</p>`;
                }
            });
            
            html += '</div>';
            summaryContent.innerHTML = html;
        }

        function exportSummary() {
            const summaryMonth = document.getElementById('summaryMonth').value;
            if (!summaryMonth) {
                alert('ກະລຸນາເລືອກເດືອນກ່ອນ Export');
                return;
            }
            
            // Generate CSV content
            let csvContent = 'ປະເພດ,ຊື່ລາຍການ,ວັນທີ,ຈຳນວນເງິນ\n';
            
            const [year, month] = summaryMonth.split('-');
            const periodStart = `${year}-${month.padStart(2, '0')}-25`;
            const nextMonth = parseInt(month) === 12 ? `${parseInt(year) + 1}-01` : `${year}-${(parseInt(month) + 1).toString().padStart(2, '0')}`;
            const periodEnd = `${nextMonth}-25`;
            
            ['income', 'expenses', 'special', 'savings'].forEach(type => {
                const title = {
                    'income': 'ລາຍຮັບ',
                    'expenses': 'ລາຍຈ່າຍ',
                    'special': 'ລາຍຮັບພິເສດ', 
                    'savings': 'ເງິນເກັບ'
                }[type];
                
                const transactions = (userData[type] || []).filter(t => 
                    t.date >= periodStart && t.date < periodEnd
                );
                
                transactions.forEach(t => {
                    csvContent += `${title},"${t.name}",${t.date},${t.amount}\n`;
                });
            });
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ສະຫຼຸບ-${summaryMonth}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Utility functions
        function formatCurrency(amount) {
            return amount.toLocaleString() + ' ₭';
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('lo-LA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // Event listeners
        document.getElementById('dashboardDate').addEventListener('change', updateDashboard);

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('addModal');
            if (event.target === modal) {
                closeModal();
            }
        });
    </script>
</body>
</html>
